{"version":3,"file":"main13.mjs","sources":["../../src/core/use-r3m.ts"],"sourcesContent":["import { RootState, _roots, useThree } from \"@react-three/fiber\";\nimport { useState } from \"react\";\nimport { Matrix4, Matrix4Tuple } from \"three\";\nimport { UseBoundStore } from 'zustand';\nimport { FromLngLat, MapInstance } from \"./generic-map\";\n\nexport interface R3M<T extends MapInstance = MapInstance> {\n  /** Map provider */\n  map: T,\n  /** view projection matrix coming from the map provider */\n  viewProjMx: Matrix4Tuple,\n  fromLngLat: FromLngLat,\n}\n\nexport function useR3M<T extends MapInstance> () {\n  const r3m = useThree(s=>(s as any).r3m) as R3M<T>; // eslint-disable-line @typescript-eslint/no-explicit-any\n  return r3m;\n}\n\n/** init `useR3M` hook */\nexport function useInitR3M<T extends MapInstance>(props: {\n  map: T; fromLngLat: FromLngLat;\n}) {\n  const canvas = useThree(s => s.gl.domElement);\n  // to run only once\n  useState(()=>{\n    const store = _roots.get(canvas)!.store; // eslint-disable-line @typescript-eslint/no-non-null-assertion\n    initR3M({...props, store})\n  })\n}\n\nexport function initR3M<T extends MapInstance>({store, ...props}: {\n  map: T;\n  fromLngLat: FromLngLat;\n  store: UseBoundStore<RootState>;\n}) {\n  const viewProjMx = new Matrix4().identity().toArray();\n  const r3m : R3M<T> = { ...props, viewProjMx };\n  store.setState({r3m} as any); // eslint-disable-line @typescript-eslint/no-explicit-any\n  return r3m;\n}"],"names":[],"mappings":";;;AAcO,SAAS,SAAiC;AAC/C,QAAM,MAAM,SAAS,CAAI,MAAA,EAAU,GAAG;AAC/B,SAAA;AACT;AAGO,SAAS,WAAkC,OAE/C;AACD,QAAM,SAAS,SAAS,CAAK,MAAA,EAAE,GAAG,UAAU;AAE5C,WAAS,MAAI;AACX,UAAM,QAAQ,OAAO,IAAI,MAAM,EAAG;AAClC,YAAQ,EAAC,GAAG,OAAO,MAAM,CAAA;AAAA,EAAA,CAC1B;AACH;AAEO,SAAS,QAA+B,EAAC,OAAO,GAAG,SAIvD;AACD,QAAM,aAAa,IAAI,QAAA,EAAU,WAAW,QAAQ;AACpD,QAAM,MAAe,EAAE,GAAG,OAAO,WAAW;AACtC,QAAA,SAAS,EAAC,IAAA,CAAW;AACpB,SAAA;AACT;"}