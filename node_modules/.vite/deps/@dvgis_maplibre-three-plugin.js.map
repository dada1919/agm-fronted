{
  "version": 3,
  "sources": ["../../@dvgis/maplibre-three-plugin/dist/index.js"],
  "sourcesContent": ["import{Group as Z,PerspectiveCamera as U,Scene as W,WebGLRenderer as k}from\"three\";var o=63710088e-1,u=2*Math.PI*o,s=Math.PI/180,z=180/Math.PI,h=1024e3/u,S=512;var w=class{static clamp(t,e,a){return Math.min(a,Math.max(e,t))}static makePerspectiveMatrix(t,e,a,r){let p=1/Math.tan(t/2),m=1/(a-r);return[p/e,0,0,0,0,p,0,0,0,0,(r+a)*m,-1,0,0,2*r*a*m,0]}static mercatorXFromLng(t){return(180+t)/360}static mercatorYFromLat(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}},l=w;import{Matrix4 as n,Vector3 as O}from\"three\";var g=new n,D=new n,L=85.051129,M=class{constructor(t){this._map=t.map,this._world=t.world,this._camera=t.camera,this._translateCenter=new n().makeTranslation(1024e3/2,-1024e3/2,0),this._worldSizeRatio=S/1024e3,this._map.on(\"move\",this.syncCamera.bind(this)),this._map.on(\"resize\",this.syncCamera.bind(this))}syncCamera(){let t=this._map.transform;this._camera.aspect=t.width/t.height;let e=t.centerOffset||new O,a=t.fov*s,r=t.pitch*s,p=t.bearing*s;g.elements=l.makePerspectiveMatrix(a,this._camera.aspect,t.height/50,t.farZ),this._camera.projectionMatrix=g,this._camera.projectionMatrix.elements[8]=-e.x*2/t.width,this._camera.projectionMatrix.elements[9]=e.y*2/t.height,D.makeTranslation(0,0,t.cameraToCenterDistance);let m=new n().premultiply(D).premultiply(new n().makeRotationX(r)).premultiply(new n().makeRotationZ(-p));t.elevation&&(m.elements[14]=t.cameraToCenterDistance*Math.cos(r)),this._camera.matrixWorld.copy(m);let _=t.scale*this._worldSizeRatio,T=new n().makeScale(_,_,_),d=t.x,f=t.y;if(!d||!f){let y=t.center,A=l.clamp(y.lat,-L,L);d=l.mercatorXFromLng(y.lng)*t.worldSize,f=l.mercatorYFromLat(A)*t.worldSize}let v=new n().makeTranslation(-d,f,0),C=new n().makeRotationZ(Math.PI);this._world.matrix=new n().premultiply(C).premultiply(this._translateCenter).premultiply(T).premultiply(v)}},P=M;var b={scene:null,camera:null,renderer:null,preserveDrawingBuffer:!1,renderLoop:i=>{i.renderer.resetState(),i.renderer.render(i.scene,i.camera)}},R=class{constructor(t,e={}){if(!t)throw\"miss map\";this._map=t,this._options={...b,...e},this._canvas=t.getCanvas(),this._scene=this._options.scene||new W,this._camera=this._options.camera||new U(this._map.transform.fov,this._map.transform.width/this._map.transform.height,.1,1e21),this._camera.matrixAutoUpdate=!1,this._renderer=this._options.renderer||new k({alpha:!0,antialias:!0,preserveDrawingBuffer:this._options.preserveDrawingBuffer,canvas:this._canvas,context:this._canvas.getContext(\"webgl2\")}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(this._canvas.clientWidth,this._canvas.clientHeight),this._renderer.autoClear=!1,this._world=new Z,this._world.name=\"world\",this._world.position.set(1024e3/2,1024e3/2,0),this._world.matrixAutoUpdate=!1,this._scene.add(this._world),this._cameraSync=void 0,this._map.on(\"style.load\",this._onStyleLoad.bind(this))}get map(){return this._map}get canvas(){return this._canvas}get camera(){return this._camera}get scene(){return this._scene}get world(){return this._world}get renderer(){return this._renderer}_onStyleLoad(){let t=this;this._map.addLayer({id:\"map_scene_layer\",type:\"custom\",renderingMode:\"3d\",onAdd:function(e,a){t._cameraSync||(this._cameraSync=new P(t),this._cameraSync.syncCamera())},render:function(e,a){t.render()}})}render(){return this._options.renderLoop(this),this}},I=R;import{Vector3 as j}from\"three\";var x=class{static projectedUnitsPerMeter(t){return Math.abs(1024e3/Math.cos(s*t)/u)}static lngLatToVector3(t,e,a=0){let r=[0,0,0];return Array.isArray(t)?(r=[-o*s*t[0]*h,-o*Math.log(Math.tan(Math.PI*.25+.5*s*t[1]))*h],t[2]?r.push(t[2]*this.projectedUnitsPerMeter(t[1])):r.push(0)):(r=[-o*s*t*h,-o*Math.log(Math.tan(Math.PI*.25+.5*s*e))*h],a?r.push(a*this.projectedUnitsPerMeter(e)):r.push(0)),new j(r[0],r[1],r[2])}static vector3ToLngLat(t){let e={lng:0,lat:0,alt:0};return t&&(e.lng=-t.x/(o*s*h),e.lat=2*(Math.atan(Math.exp(t.y/(h*-o)))-Math.PI/4)/s,e.alt=t.z/this.projectedUnitsPerMeter(e.lat)),e}},E=x;window.THREE&&(window.MapScene=I,window.SceneTransform=E);export{I as MapScene,E as SceneTransform};\n"],
  "mappings": "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",
  "names": []
}
